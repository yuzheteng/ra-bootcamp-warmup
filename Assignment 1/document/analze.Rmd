---
title: "analyze.Rmd"
output: html_document
date: "2025-08-07"
---

```{r setup, include=FALSE}
library(tidyverse)
library(readxl)
library(ggplot2)
library(scales)
library(forcats)
library(here)
```

## Read Data
```{r load data}
data1 <- readRDS("~/Desktop/ra-bootcamp-warmup/Assignment 1/data/cleaned/absence_cleaned.rds")
```


## ğŸ“ˆ å›³2ï¼š**ä¸ç™»æ ¡å‰²åˆã®æ¨ç§»ï¼ˆæŠ˜ã‚Œç·š + æ•°å€¤ä»˜ãï¼‰**
```{r summarise}

summary_rate <- data1 %>%
  group_by(year) %>%
  summarise(
    total_absent = sum(absencestudents, na.rm = TRUE),
    total_students = sum(students, na.rm = TRUE),
    total_rate = total_absent / total_students * 100
  )
summary_rate <- summary_rate %>%
  mutate(total_rate = round(total_rate, 1))
summary_rate <- summary_rate %>%
 mutate(total_absent_per_10k = total_absent / 10000)
```

## Graph1
```{r fig1, echo=FALSE}
ggplot(summary_rate, aes(x = factor(year), y = total_absent_per_10k)) +
    geom_col(fill = "steelblue") +
    labs(title = "å›³1ï¼šåˆè¨ˆä¸ç™»æ ¡è€…æ•°ã®æ¨ç§»", x = "å¹´åº¦", y = "ä¸ç™»æ ¡è€…æ•°") +
    theme_minimal(base_family = "Hiragino Sans")
```


## Graph2
```{r fig2, echo=FALSE}
ggplot(summary_rate, aes(x = year, y = total_rate)) +
  geom_line(color = "darkred") +
  geom_point() +
  geom_text(aes(label = round(total_rate, 2)), vjust = -1) +
  scale_x_continuous(
    name = "å¹´åº¦",
    breaks = seq(2013, 2022, by = 1)
  ) +
  labs(title = "å›³2ï¼šä¸ç™»æ ¡å‰²åˆã®æ¨ç§»", x = "å¹´åº¦", y = "ä¸ç™»æ ¡å‰²åˆï¼ˆ%ï¼‰") +
  theme_minimal(base_family = "Hiragino Sans")
```

## Graph3
```{r fig3, echo=FALSE}
ggplot(summary_rate, aes(x = year)) +
  geom_col(aes(y = total_absent_per_10k), fill = "skyblue") +
  geom_line(aes(y = total_rate * 2.5), color = "red", size = 1.2) +
  scale_y_continuous(
    name = "ä¸ç™»æ ¡è€…æ•°",
    sec.axis = sec_axis(~ ./2.5, name = "ä¸ç™»æ ¡å‰²åˆï¼ˆ%ï¼‰")
  ) +
  scale_x_continuous(
    name = "å¹´åº¦",
    breaks = seq(2013, 2022, by = 1)
  ) +
  labs(title = "å›³3ï¼šä¸ç™»æ ¡è€…æ•°ã¨å‰²åˆã®æ¨ç§»") +
  theme_minimal(base_family = "Hiragino Sans")
```

## Graph4
```{r fig4}
absence_2022 <- data1 %>% filter(year == 2022)
absence_2022 <- absence_2022 %>%
 mutate(total_rate = absence_rate * 100)

ggplot(absence_2022, aes(x = total_rate)) +
  geom_histogram(binwidth = 0.5, fill = "lightblue", color = "black") +
  geom_vline(aes(xintercept = mean(total_rate, na.rm = TRUE)),
             linetype = "dashed", color = "red", size = 1) +
  labs(title = "å›³4ï¼š2022å¹´ ä¸ç™»æ ¡å‰²åˆã®åˆ†å¸ƒ",
       x = "ä¸ç™»æ ¡å‰²åˆï¼ˆ%ï¼‰",
       y = "éƒ½é“åºœçœŒæ•°") +
  theme_minimal(base_family = "Hiragino Sans")
```

## Graph5
```{r fig5}
my_favorite <- "äº¬éƒ½"  # å¥½ããªå ´æ‰€ã«å¤‰æ›´

absence_2022kyoto <- absence_2022 %>%
  mutate(prefecture = fct_reorder(prefecture, absence_rate),
         color_group = if_else(prefecture == "äº¬éƒ½", "favorite", "other"))

ggplot(absence_2022kyoto, 
       aes(x = fct_reorder(prefecture, total_rate), 
           y = total_rate, 
           fill = color_group)) +  
  geom_col() +
  coord_flip() +
  scale_fill_manual(values = c("favorite" = "pink", "other" = "gray")) +
  labs(title = "å›³5ï¼š2022å¹´ ä¸ç™»æ ¡å‰²åˆï¼‰", 
       x = "éƒ½é“åºœçœŒ", 
       y = "ä¸ç™»æ ¡å‰²åˆï¼ˆ%ï¼‰") +
  theme_minimal(base_family = "Hiragino Sans") +
  theme(legend.position = "none") 
```